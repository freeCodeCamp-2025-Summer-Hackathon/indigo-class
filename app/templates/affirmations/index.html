{% extends "base.html" %} {% block title %} Affirmations {% endblock %} {% block
content %}
<h1>Affirmations</h1>

<section>
  <!-- dummy page navigation -->
  <nav>
    {% if all_affirmations.has_prev %}
    <a
      href="{{ url_for('affirmations.affirmations', page=all_affirmations.prev_num, category=request.args.get('category')) }}"
      >Previous</a
    >
    {% endif %} {% for p_num in all_affirmations.iter_pages() %} {% if p_num %}
    {% if p_num == all_affirmations.page %}
    <strong>{{ p_num }}</strong>
    {% else %}
    <a
      href="{{ url_for('affirmations.affirmations', page=p_num, category=request.args.get('category')) }}"
      >{{ p_num }}</a
    >
    {% endif %} {% else %} ... {% endif %} {% endfor %} {% if
    all_affirmations.has_next %}
    <a
      href="{{ url_for('affirmations.affirmations', page=all_affirmations.next_num, category=request.args.get('category')) }}"
      >Next</a
    >
    {% endif %}
  </nav>
  <hr />
  <!-- dummy category filtering -->
  <form action="{{ url_for('affirmations.affirmations') }}" method="get">
    <input type="hidden" name="page" value=1>

    <label for="category_select">Select Category:</label>
    <select name="category" id="category_select" onchange="this.form.submit()">
      <option value="">All Categories</option>
      {% for category in categories %}
      <option value="{{ category.name }}"
        {% if request.args.get('category') == category.name %}selected{% endif %}
      >
        {{ category.name }}
      </option>
      {% endfor %}
    </select>
    <noscript><button type="submit">Apply Filter</button></noscript>
  </form>
</section>

{% if all_affirmations.total > 0 %}
<section class="affirms__wrapper">
  {% for affirmation in all_affirmations %}
  <div class="affirm">
    <figure class="affirm__wrapper">
      <blockquote class="affirm__quote">
        {{ affirmation.affirmation_text }}
      </blockquote>
      <figcaption class="affirm__cats">
        {% for category in affirmation.categories %} 
        {{ category.category.name }}
        {% endfor %}
      </figcaption>
    </figure>
    {% if current_user.is_admin() or affirmation.user_id == current_user.user_id %}
    <div class="affirm__btn--wrapper">
      <a
        href="{{ url_for('affirmations.edit_affirmation', affirmation_id=affirmation.affirmation_id)}}"
        class="affirm__edit"
        >Edit
      </a>
      <form
        method="POST"
        action="{{ url_for('affirmations.delete_affirmation', affirmation_id=affirmation.affirmation_id) }}"
      >
        <button class="affirm__delete" type="submit">Delete</button>
      </form>
    </div>
    {% endif %}
  </div>
  {% endfor %}
</section>
{% else %}
<p>No affirmations found.</p>
{% endif %}

<section class="affirm__section--bottom">
  <a href="{{ url_for('affirmations.add_affirmation') }}" class="affirm__action"
    >Add affirmation</a
  >
</section>
{% endblock %}
